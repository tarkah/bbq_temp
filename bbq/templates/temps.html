{% extends "layout.html" %}
{% block content %}
<div class="row justify-content-center mb-3">
<canvas id="myChart" height="150" ></canvas>
</div>

<table class="table table-sm text-center">
  <thead>
    <tr>
      <th scope="col">Last Update</th>
      <th scope="col">Temp1</th>
      <th scope="col">Temp2</th>
      <th scope="col">Volts</th>
    </tr>
  </thead>
  <tbody>
    {% if temps %}
    <tr>
      <td>{{temps[0].created_local.strftime('%I:%M:%S %p')}}</td>
      <td>{{temps[0].temp_1}}</td>
      <td>{{temps[0].temp_2}}</td>
      <td>{{temps[0].volts}}</td>
    </tr>
    {% endif %}
  </tbody>
</table>

<a class="btn btn-primary mb-3" data-toggle="collapse" href="#tableCollapse" role="button" aria-expanded="false" aria-controls="tableCollapse">
  Toggle Table
</a>
<div class="collapse" id="tableCollapse">
<div class="row justify-content-center">
<table class="table table-striped table-hover table-sm text-center">
  <thead>
    <tr>
      <th scope="col">Id</th>
      <th scope="col">Temp1</th>
      <th scope="col">Temp2</th>
      <th scope="col">Volts</th>
      <th scope="col">Time</th>
    </tr>
  </thead>
  <tbody>
    {% if temps %}
    {% for temp in temps|sort(attribute='id', reverse=True) %}
    <tr>
      <th scope="row">{{temp.sesssion_temp_id}}</td>
      <td>{{temp.temp_1}}</td>
      <td>{{temp.temp_2}}</td>
      <td>{{temp.volts}}</td>
      <td>{{temp.created_local.strftime('%I:%M:%S %p')}}</td>
    </tr>
    {% endfor %}
    {% endif %}
  </tbody>
</table>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
<script>
    var timeFormat = 'YYYY-MM-DD h:mm:ss a';
    var color = Chart.helpers.color;
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [{% for temp in temps %} "{{temp.created_local.strftime('%Y-%m-%d %I:%M:%S %p')}}", {% endfor %}],
            datasets: [{
                label: 'Temp 1',
                data: [{% for temp in temps %} "{{temp.temp_1}}", {% endfor %}],
                backgroundColor: color("rgb(255, 99, 132)").alpha(0.5).rgbString(),
					      borderColor: "rgb(255, 99, 132)",
					      pointRadius: 0,
					      fill: false,
					      lineTension: 0,
					      borderWidth: 2            
                    }, {
              label: 'Temp 2',
                data: [{% for temp in temps %} "{{temp.temp_2}}", {% endfor %}],                
                backgroundColor: color("rgb(54, 162, 235)").alpha(0.5).rgbString(),
					      borderColor: "rgb(54, 162, 235)",
					      pointRadius: 0,
					      fill: false,
					      lineTension: 0,
					      borderWidth: 2 
            }]
        },
        options: {
          scales: {
					  xAxes: [{
  						type: 'time',
						  time: {
  							parser: timeFormat,
							  // round: 'day'
							  tooltipFormat: 'YYYY-MM-DD h:mm:ss a',
                displayFormats: {
                  second: 'h:mm:ss a',
                  day: 'MMM D'
                }
						  },
              ticks: {
                autoSkip: true
              },
						  scaleLabel: {
  							display: false,
							  labelString: 'Date'
						  }
					  }],
					  yAxes: [{
  						scaleLabel: {
							  display: false,
							  labelString: 'value'
						  }
					  }]
				  },
          tooltips: {
					  intersect: false,
					  mode: 'index',
					  callbacks: {
						  label: function(tooltipItem, myData) {
							  var label = myData.datasets[tooltipItem.datasetIndex].label || '';
							  if (label) {
  								label += ': ';
							  }
							  label += tooltipItem.yLabel;
  							return label;
						  }
				  	}
				}
        }
    });
    </script>
{% endblock %}